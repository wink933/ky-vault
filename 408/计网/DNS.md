---
topic: DNS
module: 应用层
tags:
  - "#应用层"
  - "#DNS"
  - "#命名解析"
one_liner: 分层命名解析：递归/迭代 + 多级缓存TTL；默认UDP，必要时转TCP
updated: 2026-01-22
---

> [!summary] 🧠 概念卡｜DNS（应用层）  
> **结论条**：分层命名→根/顶级域/权威分工；递归=替你查到最终答案、迭代=每步返回下一跳；多级缓存+TTL换性能但牺牲一致性；RR决定返回内容(A/AAAA/CNAME/NS…)；默认UDP，截断/区域传送等场景转TCP

> [!note] 🎯 为什么需要（只写“问题与动机”，不写定义）
> 
> - 没有DNS：只能记IP；地址变更会引发大规模配置/维护成本，易出错且难演进
>     
> - 需要同时满足：全球可扩展(分层授权)；低时延(就近/缓存)；可演进(通过RR扩展语义)
>     
> - 不直接用“集中式表/广播问”：集中式易成单点与瓶颈；广播不可扩展且噪声巨大
>     

> [!info] 🔗 机制链条（背诵版｜结构清晰）  
> 触发(应用访问域名需IP)  
> → 输入(QNAME+QTYPE)  
> → 核心步骤〔1查客户端/递归缓存；2未命中：根→TLD→权威；3得到RR并按TTL写缓存〕  
> → 输出〔A/AAAA；若CNAME则继续解析直到A/AAAA落地〕  
> → 副作用/代价〔TTL导致更新传播滞后；递归解析器负载与安全风险集中〕  
> → 失败/异常分支〔NXDOMAIN/超时；污染/投毒；响应截断/区域传送转TCP〕

> [!tip] 🧭 流程/状态机（伪图示｜画关键分支）
> 
> ```text
> 应用发起解析(QNAME,QTYPE)
>   |
>   v
> 客户端缓存(浏览器/OS/hosts) --命中--> 返回RR
>   |
> 未命中
>   v
> 递归解析器缓存 --命中--> 返回RR(+剩余TTL)
>   |
> 未命中
>   v
> 根(.) --返回--> TLD(.com等)
> TLD  --返回--> 权威(example.com)
> 权威 --返回--> RR(A/AAAA/CNAME/NS/MX/TXT...)
>   |
>   +--若RR为CNAME--> 以新名字继续解析直到A/AAAA
>   +--若RR为A/AAAA--> 结束
>   +--若TC=1/响应过大/区域传送--> 改用TCP 53
>   +--若RCODE=3--> NXDOMAIN(名字不存在)
>   |
>   v
> 写入递归缓存(TTL) -> 返回客户端 -> 写入客户端缓存 -> 应用获得结果
> ```
> 
> - 题目常问的“分支点”：递归vs迭代 / 缓存命中层级与TTL / CNAME链是否继续解析 / UDP何时转TCP
>     

> [!abstract] 🧾 最小对比表（只保留能得分的维度）
> 
> |维度|方案A：递归查询|方案B：迭代查询|
> |---|---|---|
> |目标|客户端一次拿到最终答案（解析器替你跑腿）|每一步拿到“下一跳该问谁”，直到权威|
> |代价|递归解析器压力与风险集中；更依赖缓存与策略|交互步数显式；更考“每步返回什么”|
> |典型考法|“本地域名服务器/缓存/TTL为何加速”|“根→TLD→权威顺序、每步返回什么”|

>[!question] 🧩 真题命题信号词 → 直接定位
> - ? “本地域名服务器/递归解析器” → 递归流程 + 先查缓存；再判是否访问根/TLD/权威
>     
> - ? “根/顶级域/权威服务器” → 画迭代链：根→TLD→权威；强调每步返回“下一跳线索”
>     
> - ? “第二次访问更快/改IP不生效/TTL” → 缓存命中 + TTL未过期 → 结果可能滞后
>     
> - ? “CDN/别名/跳转” → CNAME指向新域名；必须继续解析落到A/AAAA；可配合多A做就近/负载
>     

> [!warning] ⚠ 易错点清单（带自检）
> 
> -  我能用一句话说清 **递归=替你查完、迭代=指路下一跳** 吗？
>     
> -  我能指出 **TTL未过期** 时“改IP仍可能拿旧结果”的原因吗？
>     
> -  我能解释 **CNAME必须继续解析到A/AAAA** 吗？
>     
> -  我能反驳 **“根服务器保存所有域名-IP/缓存永久有效/DNS默认TCP”** 吗？
>     

> [!success] ✅ 可直接套用的答题骨架（选择/简答通用）
> 
> 1. 先判：题干是在问递归解析器如何代查，还是在考迭代链(根→TLD→权威)
>     
> 2. 再走：优先说明缓存命中层(客户端/递归)与TTL；未命中按层级迭代拿RR；若CNAME则继续解析直到A/AAAA
>     
> 3. 最后补：默认UDP；截断/大响应/区域传送转TCP；异常看NXDOMAIN/超时/污染  
>     **一句话模板**：先判递归/迭代；先查缓存并说明TTL；未命中走根→TLD→权威拿RR，CNAME继续落A/AAAA；最后点出UDP/TCP与异常边界。
>     

> [!quote] 🔗 知识网络（双链串题）
> 
> - 上游触发：[[HTTP]] / [[HTTPS]]
>     
> - 下游依赖：[[UDP]] / [[TCP]]
>     
> - 常一起考：[[CDN]] / [[缓存与一致性]] / [[DNS污染与劫持]]

