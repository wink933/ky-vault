---

topic: "DNS"  
module: "应用层"  
input_type: "概念"  
exam_weight: "高"  
one_liner: "把“人类可读域名”稳定映射到“可路由的IP/服务位置”，并用分层授权+缓存把全网查询成本压到可控。"  
why_needed:

- "应用发起连接前必须拿到对端IP或服务入口；手工维护hosts在规模与变更频率下不可用"
    
- "域名到地址/服务会动态变化(扩容、容灾、CDN调度)，需要可缓存但可更新的分布式映射系统"
    
- "需要“分权管理”：不同组织各管各的域(Zone)，又能在全球范围内一致查询"
    

keywords:

- "分层命名：根/顶级域/权威DNS/区域(Zone)/委派(NS)"
    
- "查询链：递归解析器/迭代查询/缓存(TTL)/负缓存"
    
- "资源记录RR：A/AAAA/CNAME/NS/MX/TXT/SRV/PTR"
    
- "DNS报文：ID/Flags(QR,RD,RA,TC)/Question/Answer/Authority/Additional"
    
- "传输：UDP 53为主；TCP用于截断(TC=1)续查、区域传送、超大响应"
    
- "反向解析：in-addr.arpa/ip6.arpa"
    
- "安全与现实：DNS劫持/缓存投毒/DNSSEC(了解考点)"
    

signals:

- "题干出现：递归/迭代/权威/本地DNS/根服务器/TTL/缓存命中/NS委派/CNAME链"
    
- "问：一次解析要访问哪些服务器、访问顺序、命中缓存后省略哪些步骤"
    
- "给RR集合或抓包字段，问：哪个是权威答案/哪条在Authority/Additional里/TC=1意味着什么"
    
- "问：CDN调度为什么依赖DNS、本地DNS位置如何影响返回结果"
    

pitfalls:

- "把“递归查询”和“迭代查询”对象搞反：主机通常对本地递归解析器发递归；解析器对外多为迭代"
    
- "把CNAME当作最终地址：CNAME只指别名，最终还要再解析到A/AAAA(可能多跳)"
    
- "忽略缓存：认为每次都要问根/TLD/权威；实际缓存命中可直接返回且受TTL约束"
    
- "误判UDP/TCP：不是“DNS都走TCP”，而是UDP为主；超大/截断/区域传送才常见TCP"
    
- "把权威DNS与本地DNS混为一谈：权威负责“我管辖区的最终答案”，本地负责“替你跑腿+缓存”"
    

comparisons:

- "递归解析_vs_迭代解析"
    
- "权威DNS_vs_本地递归解析器"
    
- "A/AAAA_vs_CNAME"
    
- "DNS缓存_vs_hosts静态映射"
    

links:

- "HTTP/CDN：就近调度常靠DNS返回不同IP(地理/运营商/负载)"
    
- "传输层：UDP首包快但受报文大小限制；TC=1触发TCP重查"
    
- "安全：ARP/路由/DNS劫持链路，区分“本地被改”与“解析器被污染”"
    
- "DHCP：下发本地DNS服务器地址，影响解析路径与缓存位置"
    

source: "2026计算机网络.pdf 第6章 DNS"  
pattern_name: "主机→本地递归解析器(递归)→根/TLD/权威(迭代)→缓存(按TTL)→返回答案"  
last_update: "2026-01-22"  
tags:

- "DNS"
    
- "应用层"
    
- "域名解析"
    
- "缓存"
    
- "CDN"
    

---

## 1) 速记总结

- 主机通常只问**本地递归解析器**一次；真正跑全网链路的是解析器
    
- 外部查询多是**迭代**：根给“下一跳(TLD/权威线索)”而非最终答案
    
- 解析性能核心靠**缓存(TTL)**：命中则跳过根/TLD/权威
    
- CNAME不是终点：**别名链最终要落到A/AAAA**
    

## 2) 机制链条（可背版本）

应用需要访问某域名但未知可达地址/服务入口 → 输入(域名QNAME、查询类型QTYPE、本地DNS地址、缓存与TTL) → 核心步骤(1主机向本地递归解析器发递归查询RD=1 2解析器查缓存命中则直接答复 3未命中则从根开始迭代：根→TLD→权威获取委派NS与必要的附加A/AAAA 4拿到权威答案RR集(可能含CNAME需继续追踪) 5将结果按TTL写入缓存并回复主机) → 输出(域名→A/AAAA或服务RR) → 副作用/代价(缓存导致“旧答案”窗口、解析器位置影响调度结果、额外RTT) → 失败/异常分支(NXDOMAIN与负缓存、超时重试、TC=1转TCP续查、被劫持/投毒返回错误答案)

## 3) 状态机/流程（伪图示）

```
[Host] --递归查询(RD=1)--> [Local Recursive Resolver]
                 |
                 v
           (缓存命中?)--是--> 直接返回(Answer)
                 |否
                 v
        [Root] --给TLD线索(NS+可能的Glue)-->
                 v
        [TLD]  --给权威线索(NS+Glue)-->
                 v
      [Authoritative] --返回Answer(或CNAME/NS等)-->
                 |
                 v
      (若CNAME?)--是--> 追踪新QNAME(可能再次走缓存/迭代)
                 |否
                 v
      写缓存(按TTL) -> 返回Host

UDP响应过大/TC=1:
[Resolver] --UDP query--> [Server]
[Server] --TC=1--> [Resolver] --TCP重查--> [Server] --完整响应-->
```

## 4) 代价与边界

- **一致性边界(TTL窗口)**：缓存提升性能但引入“变更传播延迟”；TTL越大越省流量但越不灵活
    
- **大小边界(UDP限制)**：UDP更快但响应大小受限；截断(TC=1)需TCP补查
    
- **调度边界(解析器位置)**：CDN常按“本地DNS的出口位置”做就近调度，解析器跨地域会让调度变差
    
- **可靠性边界**：解析器/权威不可达会导致业务不可用；重试与多解析器策略是工程常见补丁
    
- **安全边界**：缓存投毒/劫持会把域名导向错误IP；DNSSEC能增强可信度但部署与链路支持是现实门槛
    

## 5) 对比与替代（最小对比表）

|维度|方案A：DNS分层+缓存|方案B：hosts静态映射|
|---|---|---|
|目标|全球可扩展的动态解析与分权管理|小规模固定映射、零查询开销|
|代价|解析链路RTT、缓存一致性窗口、安全风险|维护成本爆炸、无法应对频繁变更/多入口/容灾|
|典型考法|递归vs迭代、访问顺序、TTL命中、RR类型与CNAME链、TC=1|常作为“为什么不能用hosts替代DNS”的反证点|

## 6) 真题命题模板

- 模板A：解析链路推演  
    给：缓存状态(命中/未命中)、域名层级 → 问：访问哪些服务器、顺序、最少几次查询
    
- 模板B：RR与报文区段辨识  
    给：RR集合/抓包段落 → 问：哪条是权威答案、Authority/Additional放什么、Glue记录作用
    
- 模板C：CNAME链与最终落点  
    给：CNAME多跳 → 问：最终需要几次解析、缓存能省哪几步、什么时候会重复查询
    
- 模板D：UDP/TCP切换  
    给：TC=1或响应过大场景 → 问：为何改用TCP、对时延/可靠性影响是什么
    

## 7) 易错点清单（带自检）

-  我是否分清“主机→本地DNS(递归)”与“解析器→外部服务器(迭代)”
    
-  我是否把CNAME当最终IP而忘了继续追踪到A/AAAA
    
-  我是否在计算查询次数时考虑了缓存命中与TTL
    
-  我是否知道TC=1意味着“截断，去TCP拿完整答案”
    
-  我是否分清权威DNS(最终答案)与本地递归解析器(跑腿+缓存)
    

## 8) 迁移题型模型（可直接套用）

- “三段数查询”模型：先看是否命中本地缓存；未命中才算根→TLD→权威；遇CNAME再追加链路
    
- “区段定位”模型：Answer放最终RR；Authority多放NS委派线索；Additional常放Glue(A/AAAA)加速下一跳
    
- “调度归因”模型：返回不同IP不一定是“权威不同”，可能是“解析器位置不同/EDNS Client Subnet等扩展(了解即可)”
    
- “故障分层”模型：解析失败先判NXDOMAIN/超时/被劫持；再定位是本地DNS问题还是权威不可达
    

## 9) 知识网络（用于串题）

- 与HTTP/CDN：域名解析阶段决定接入点，影响时延与带宽；常与“就近访问”一起考
    
- 与传输层：DNS首包多用UDP；截断/区域传送用TCP，串到“为什么需要TCP”
    
- 与DHCP：下发DNS服务器地址决定“递归解析器是谁”，影响缓存与调度
    
- 与安全：DNS劫持/投毒与ARP投毒/路由劫持可串成“流量被导向错误目的地”的链路题