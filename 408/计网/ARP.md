---
topic: ARP（地址解析协议）
module: 网络层
tags:
  - "#ARP"
  - "#IPv4"
  - "#LAN"
one_liner: 在同一链路内把下一跳IPv4地址映射为MAC地址，支撑以太网交付
updated: 2026-01-22
---

> [!summary] 🧠 概念卡｜ARP（网络层）
> 
> - 你要把IP包交给“同一链路上的下一跳”，但网卡只认识MAC：ARP专门补上这一步映射
>     
> - 只在**本广播域/同一链路**内起作用；跨网段靠路由器，ARP找的是“下一跳”的MAC
>     
> - 关键产物：ARP缓存表（IP→MAC，带老化），减少广播
>     
> - 常考抓手：广播/单播方向、缓存命中、同网段vs不同网段、免费ARP/ARP欺骗
>     
> - 参考：
>     

> [!note] 🎯 为什么需要（只写“问题与动机”，不写定义）
> 
> - IP层只决定“下一跳IP”，但链路层发帧必须填“目的MAC”，两层字段不直接互推
>     
> - 不能每发一个IP包都靠全网广播问MAC：需要缓存与老化折中
>     
> - 需要在主机移动/网卡更换/地址冲突时能快速“刷新认知”（免费ARP、探测）
>     
> - 需要支持“同网段直达”和“不同网段先交给网关”两条路径
>     

> [!info] 🔗 机制链条（背诵版｜结构清晰）
> 
> - 触发(要发送IPv4数据报到目的IP/下一跳IP，但未知其MAC)
>     
> - → 输入(目的IP、子网掩码/路由结果得到的下一跳IP、ARP缓存表)
>     
> - → 核心步骤〔查ARP缓存命中则直接封装；未命中则广播ARP请求；目标主机/网关单播ARP应答；双方更新缓存并继续发送〕
>     
> - → 输出〔得到“下一跳IP→MAC”的映射；以太网帧目的MAC可填写并发出〕
>     
> - → 副作用/代价〔广播开销；缓存可能过期/污染；易被欺骗导致流量劫持〕
>     
> - → 失败/异常分支〔无人应答→重试后报告不可达/发送失败；应答冲突/异常→可能IP冲突或被ARP欺骗〕
>     

> [!tip] 🧭 流程/状态机（伪图示｜画关键分支）
> 
> ```text
> 发送IP数据报
>   |
>   v
> 路由判定下一跳IP (同网段=目的IP；不同网段=默认网关IP)
>   |
>   v
> 查ARP缓存[下一跳IP]
>   |--- 命中 ---> 取MAC -> 封装以太网帧(dst=MAC) -> 发送
>   |
>   '--- 未命中 --->
>          生成ARP Request (who has X? tell me) 以太网广播(dst=FF:FF:FF:FF:FF:FF)
>          |
>          v
>        等待ARP Reply(单播回发)
>          |--- 收到 ---> 更新ARP缓存(含老化计时) -> 继续封装发送
>          |
>          '--- 超时/重试N次失败 ---> 交付失败(上报/丢弃/触发ICMP不可达*视实现)
> 
> 补充分支：
> - Gratuitous ARP(免费ARP)：主动广播“X is at MAC”，用于刷新别人缓存/检测冲突
> - ARP欺骗：伪造Reply污染缓存 -> 需要静态ARP/DAI/隔离/VLAN等防护
> ```

> [!abstract] 🧾 最小对比表（只保留能得分的维度）
> 
> |维度|ARP|路由/转发|DNS|
> |---|---|---|---|
> |解决的问题|同链路：IP→MAC|跨网段：选下一跳/出接口|名字→IP|
> |作用范围|广播域内|全网（逐跳）|全网（递归/迭代）|
> |典型报文方向|Request广播；Reply单播|单播逐跳|多为单播（UDP/TCP）|
> |状态/缓存|ARP缓存(老化)|路由表/转发表|DNS缓存(TTL)|
> |常见坑|“找目的主机MAC”vs“找网关MAC”|转发看目的IP不看端口|CNAME链/缓存命中|

> [!question] 🧩 真题命题信号词 → 直接定位
> 
> - “同一子网/同一网段/同一局域网” → 下一跳IP=目的IP，ARP找**对端主机MAC**
>     
> - “不同子网/跨网段/经过路由器/默认网关” → 下一跳IP=网关IP，ARP找**网关MAC**
>     
> - “广播帧/FF:FF:FF:FF:FF:FF” → 多半在考ARP Request或免费ARP
>     
> - “ARP缓存表/老化时间/动态/静态ARP” → 命中与更新逻辑、污染风险
>     
> - “ARP欺骗/中间人/断网/网关被替换” → 缓存被投毒→流量劫持/黑洞
>     

> [!warning] ⚠ 易错点清单（带自检）
> 
> -  我是否把“跨网段”情况下的ARP对象误写成“目的主机MAC”（正确：网关MAC）？
>     
> -  我是否忘了ARP Request是**二层广播**，而ARP Reply通常是**单播**？
>     
> -  我是否把ARP说成“跨路由器传播”（正确：不跨广播域）？
>     
> -  我是否把“ARP缓存表”当成“永久正确”（正确：会老化、会被污染）？
>     
> -  我是否忽略了“免费ARP”的用途（刷新缓存/检测冲突/地址变更宣告）？
>     
> -  题目给了掩码/网关，我是否先算清“下一跳IP是谁”再谈ARP？
>     

> [!success] ✅ 可直接套用的答题骨架（选择/简答通用）
> 
> - 先判定下一跳：同网段→下一跳=目的IP；不同网段→下一跳=默认网关IP
>     
> - 查ARP缓存：命中→直接得到MAC封装帧；未命中→广播ARP Request询问“谁有下一跳IP”
>     
> - 目标返回：拥有该IP的主机/网关单播ARP Reply告知MAC，双方更新ARP缓存（带老化）
>     
> - 继续发送：以太网帧目的MAC=该MAC，IP首部目的IP仍是原目的IP（跨网段时不变）
>     
> - 代价与风险：广播开销+缓存老化/污染；可被ARP欺骗→需要静态ARP/交换机DAI等防护
>     

> [!quote] 🔗 知识网络（双链串题）
> 
> - ARP把[[IPv4]]的“下一跳选择”落到[[以太网]]的“目的MAC填充”
>     
> - 与[[子网划分]]/[[默认网关]]强绑定：先算同网段与否，再谈ARP对象
>     
> - 故障定位链：ARP失败 → 本地二层问题/广播域问题；跨网段不通还要联动[[路由与转发]]、[[ICMP]]（不可达/超时）
>     
> - 安全串题：[[ARP欺骗]] → 中间人/断网；交换机侧可联动[[VLAN]]隔离与安全特性
>