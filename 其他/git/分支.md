## 分支（Branch）是什么：先抓住本质

在 Git 里，**分支本质上只是一个“指向某个 commit 的指针（名字）”**。

- `main` / `master` / `dev` / `feature/login` 都是“指针名”
    
- 指针指向某个提交（commit）
    
- **你在该分支上产生新 commit 时，这个指针会往前移动**
    
- `HEAD` 表示你当前“站在哪个指针上”（当前检出分支）
    

> 直觉类比：分支不是复制一份代码，而是“给同一条提交历史线分出不同走向的路标”。

---

# 1) 为什么需要分支（解决什么问题）

如果只有一条线（所有人都往 `main` 提交）会发生：

- 功能没写完就污染主线
    
- 多人开发互相干扰
    
- 回滚困难：一个 commit 混了多件事
    

分支带来的好处：

- **隔离**：新功能/实验/修 bug 不影响主线
    
- **并行**：多人各自分支推进，最后合并
    
- **可控合并**：通过 PR/Review 决定何时进入 main
    

---

# 2) 分支在图里长什么样（一定要会脑补）

假设 main 上有 3 次提交：

```
A --- B --- C   (main)
```

你从 C 开一个分支 feature：

```
A --- B --- C   (main)
              \
               D --- E   (feature/login)
```

- `main` 指向 C
    
- `feature/login` 指向 E
    
- `HEAD` 指向你当前所在分支
    

合并回 main 后可能变成（merge commit 形式）：

```
A --- B --- C -------- F   (main)
              \      /
               D --- E     (feature/login)
```

---

# 3) 你要掌握的分支三件套：创建 / 切换 / 查看

### 3.1 查看本地分支

```bash
git branch
```

### 3.2 创建并切换到新分支（推荐）

```bash
git switch -c feature/login
```

（老命令等价：`git checkout -b feature/login`）

### 3.3 切换分支

```bash
git switch main
```

### 3.4 查看分支指向、追踪关系（很有用）

```bash
git branch -vv
```

---

# 4) 分支的“远端版本”与追踪分支（和 GitHub 强相关）

## 4.1 本地分支 vs 远端分支

- 本地：`main`、`feature/login`
    
- 远端：`origin/main`、`origin/feature/login`
    

`origin/*` 并不是你本地分支，而是你本地保存的“远端快照引用”。

你用：

```bash
git fetch
```

更新这些“远端快照”。

## 4.2 第一次 push 新分支要做什么

```bash
git push -u origin feature/login
```

`-u` 的作用：建立追踪关系（以后你只用 `git push` / `git pull` 就行）

---

# 5) 合并分支：merge vs rebase（新手必懂）

## 5.1 merge：保留分叉历史（团队常用，直观）

在 main 上合并 feature：

```bash
git switch main
git merge feature/login
```

特点：

- ✅ 不改历史（安全）
    
- ✅ 能看见分支结构
    
- ❌ 历史可能出现“合并节点”较多
    

## 5.2 rebase：把分支“搬到”最新 main 后面（历史更直线）

在 feature 上执行：

```bash
git switch feature/login
git fetch origin
git rebase origin/main
```

特点：

- ✅ 历史更直线、更干净
    
- ❌ 会“重写提交历史”（共享分支慎用）
    

**新手建议规则：**

- 个人分支、还没给别人用：可以 rebase
    
- 已经共享、多人在上面提交：别 rebase（容易乱）
    

---

# 6) 分支开发的标准流程（单人/多人都通用）

### 6.1 从 main 拉最新，然后开分支

```bash
git switch main
git pull
git switch -c feature/login
```

### 6.2 在分支上提交

```bash
git add -A
git commit -m "feat: add login UI"
```

### 6.3 推到 GitHub 并发 PR

```bash
git push -u origin feature/login
```

然后在 GitHub 网页创建 PR：`feature/login -> main`

### 6.4 合并后清理分支（可选但推荐）

- 删除本地分支：
    

```bash
git branch -d feature/login
```

- 删除远端分支：
    

```bash
git push origin --delete feature/login
```

---

# 7) 常见问题与坑

## 7.1 我切分支时提示有未提交改动怎么办？

因为工作区改动会跟着你走，可能影响另一个分支。

解决思路三选一：

1. 先提交：
    

```bash
git add -A
git commit -m "wip: save work"
```

2. 临时搁置（stash）：
    

```bash
git stash
git switch other-branch
# 用回改动：
git stash pop
```

3. 放弃改动（危险）：
    

```bash
git restore .
```

---

## 7.2 为什么我的分支落后 main 很多？

你需要把 main 的新提交合并/变基到你的分支：

- 用 merge（安全）：
    

```bash
git switch feature/login
git merge main
```

- 用 rebase（历史直线）：
    

```bash
git switch feature/login
git rebase main
```

---

## 7.3 分支名怎么取更专业？

常见命名：

- `feature/xxx`
    
- `bugfix/xxx`
    
- `hotfix/xxx`
    
- `docs/xxx`
    
- `refactor/xxx`
    

例子：

- `feature/oauth-login`
    
- `bugfix/null-pointer`
    
- `docs/git-tutorial`
    

---

# 8) 一句话总结分支

> **分支是指向 commit 的指针，用来隔离改动、并行开发；最终通过 merge/rebase 把分支的成果纳入主线。**

---

