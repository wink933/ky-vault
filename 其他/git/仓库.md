
## 仓库（Repository）是什么

在 Git 里，“仓库”通常有两层含义：

1. **本地仓库（Local repository）**：你电脑上项目目录里的 **`.git/`** 隐藏文件夹
    
2. **远端仓库（Remote repository）**：GitHub/GitLab 上托管的那份仓库
    
---

# 1. 本地仓库：`.git/` 里到底有什么

当你在项目里执行：

```bash
git init
```

Git 会在当前目录创建一个 `.git/`，它就是**本地仓库**，里面存着：

- 你的所有 **提交（commit）历史**
    
- 你所有 **分支（branch）** 的指针
    
- `HEAD` 指针（你当前“站在哪个分支/提交”）
    
- 对象数据库（文件内容快照、目录结构、提交对象）
    
- 暂存区的索引（Index）
    

> 一句话：**本地仓库 = 保存“可回溯历史”的地方**。  
> 你只要 commit 过的内容，就算离线也永远在 `.git/` 里。

---

# 2. 仓库如何“保存版本”：commit 不是“保存差异”，而是“快照”

很多新手以为 Git 每次 commit 只存“差异”。更准确的理解是：

- 每次 commit 代表项目在那一刻的**完整快照**
    
- 但 Git 内部会对重复内容做**去重**，所以不会真的把所有文件复制一遍
    

所以：

- 你可以随时把仓库恢复到任意一次 commit 的状态
    
- `git log` 看的是一条由 commit 串起来的历史链
    

---

# 3. commit 在仓库里是什么地位（理解历史线）

每个 commit 都有：

- 一个 **commit id（哈希）**
    
- 一个或多个 **父提交**（形成历史链/树）
    
- 作者、时间、提交信息
    
- 指向一个“快照根目录”的引用
    

常用查看：

```bash
git log --oneline --graph --decorate
```

你会看到类似：

```
* a1b2c3d (HEAD -> main) feat: add login
* 9f8e7d6 fix: typo
* 123abcd init
```

解释：

- `main` 是一个指向最新 commit 的指针
    
- `HEAD -> main` 表示你当前就在 main 分支上
    
- 每往下就是更早的历史
    

---

# 4. 分支在仓库里到底是什么（本质很简单）

分支不是“复制一份代码”。  
**分支 = 一个指向某个 commit 的指针**。

创建分支：

```bash
git switch -c feature/a
```

此时仓库里只是多了一个指针 `feature/a`，指向当前 commit。之后你在这个分支上提交，指针会往前走。

查看分支：

```bash
git branch -vv
```

---

# 5. HEAD：你当前“站在哪儿”

`HEAD` 是一个特殊指针，表示你现在检出的目标。

- 正常：`HEAD -> main`（HEAD 指向一个分支）
    
- 特殊：detached HEAD（HEAD 直接指向某个 commit，而不是分支）
    

你会在这些场景遇到 detached HEAD：

```bash
git checkout <commit_id>
```

这时你还能看代码、还能提交，但提交可能“悬空”不好找。解决方法通常是：**立刻建分支**：

```bash
git switch -c hotfix-from-old
```

---

# 6. 仓库相关的核心命令（你要会用来“读历史”和“回到过去”）

## 6.1 看历史与定位版本

```bash
git log
git log --oneline --graph --decorate
```

## 6.2 看某次提交改了什么

```bash
git show <commit_id>
```

## 6.3 比较两个版本差异

```bash
git diff <commit1> <commit2>
```

## 6.4 回到某个版本：两大路线（安全 vs 强力）

### 安全路线：revert（推荐，尤其是已经 push 后）

生成一个“反向提交”，不改历史：

```bash
git revert <commit_id>
```

### 强力路线：reset（慎用）

把分支指针直接挪回去（可能改历史）：

- 保留改动在工作区（回到过去，但代码不丢）：
    

```bash
git reset --soft <commit_id>
```

- 丢弃所有改动（危险）：
    

```bash
git reset --hard <commit_id>
```

> 口诀：**公共历史用 revert，私有历史可 reset**。

---

# 7. 远端仓库（GitHub）和本地仓库的关系

远端仓库不是“另一种 Git”，它只是你本地仓库历史的一份副本。

- **commit 永远发生在本地仓库**
    
- **push**：把本地仓库的新提交上传到远端仓库
    
- **pull**：把远端仓库的新提交拿下来并合并到本地
    

常用：

```bash
git remote -v
git push
git pull
git fetch
```

> `fetch` 只下载不合并；`pull` = fetch + merge（默认）。

---

# 8. 一个完整的“仓库视角”例子：从提交到同步

1. 你在工作区改文件
    
2. `git add` 放进暂存区
    
3. `git commit` 写入本地仓库（历史多一个节点）
    
4. `git push` 同步到 GitHub 远端仓库
    

```bash
git add -A
git commit -m "feat: update docs"
git push
```

---

# 9. 新手理解仓库最关键的一句话

> **仓库（.git）保存的是“所有提交形成的历史世界”，分支和 HEAD 只是指向这些历史节点的指针；你能回溯、对比、协作，全靠它。**

---

解释：

- `main` 是一个指向最新 commit 的指针
    - 12
    - 23
- 23432
- 234


