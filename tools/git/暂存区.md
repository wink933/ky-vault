## 暂存区（Staging Area / Index）是什么

**暂存区**是 Git 在提交前提供的一层“中转站/清单”，用来明确：

> **这次 commit 里到底要包含哪些改动（精确到文件/甚至行）**



## 为什么需要暂存区（它解决了什么痛点）

如果没有暂存区，你每次提交只能：

- 要么提交全部改动
    
- 要么什么都不提交
    

但现实中你经常会这样：

- 改了 **A 功能** + 顺手修了 **B 的小 bug**  
    → 你想把它拆成两个 commit，方便回溯与审查
    
- 改了一个文件的 **两段内容**  
    → 只想先提交其中一段（另一段还没写完）
    

**暂存区让你可以“选择性提交”**：一次 commit 只包含你想包含的那部分改动。

## 暂存区里常见状态（你要会看 `git status`）

运行：

`git status`

你会看到两类非常关键的信息：

### 1) Changes to be committed（已暂存）

这部分就是 **暂存区内容**，下一次 `git commit` 会把它们打包进历史。

### 2) Changes not staged for commit（未暂存）

这部分是 **工作区改动**，不会进入下一次 commit，除非你 `git add`。

> 同一个文件可以同时出现在这两块里：  
> 表示你“add 过一版”，但后来又继续改了工作区内容。


## 暂存区的核心命令（必须掌握）

### 1) 把改动放进暂存区：`git add`

- 暂存一个文件：
    

`git add file.md`

- 暂存全部改动（最常用）：
    

`git add -A`

- 暂存当前目录（常见但不如 -A 明确）：
    

`git add .`

✅ 推荐：**用 `git add -A`**，它会包含新增/修改/删除，语义清晰。

---

### 2) 看暂存区到底准备提交什么：`git diff --staged`

这条命令非常关键：

`git diff --staged`

它会展示：

> **暂存区 vs 上一次提交（HEAD）** 的差异  
> 也就是：**你即将 commit 的内容**

对应关系：

- `git diff`：工作区（未暂存）改了啥
    
- `git diff --staged`：暂存区（待提交）是什么
    

---

### 3) 把文件从暂存区撤回（取消暂存）：`git restore --staged`

你 add 错了文件，想“撤回到工作区”，用：

`git restore --staged file.md`

撤回全部暂存：

`git restore --staged .`

> 注意：这不会丢工作区改动，只是把“准备提交清单”撤销。